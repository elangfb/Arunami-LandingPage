rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Form submissions: anyone can CREATE, but only authenticated admins can READ/UPDATE/DELETE
    match /form_submissions/{submission} {
      // Allow anyone to submit the form (create only)
      allow create: if
        request.resource.data.keys().hasAll(['name', 'type', 'email', 'whatsapp', 'message']) &&
        request.resource.data.name is string &&
        request.resource.data.name.size() > 0 &&
        request.resource.data.name.size() <= 200 &&
        request.resource.data.type in ['Entrepreneur', 'Investor', 'Others'] &&
        request.resource.data.email is string &&
        request.resource.data.email.size() > 0 &&
        request.resource.data.email.size() <= 320 &&
        request.resource.data.whatsapp is string &&
        request.resource.data.whatsapp.size() > 0 &&
        request.resource.data.whatsapp.size() <= 20 &&
        request.resource.data.message is string &&
        request.resource.data.message.size() > 0 &&
        request.resource.data.message.size() <= 5000;

      // Only authenticated users (your admin panel) can read, update, or delete
      allow read, update, delete: if request.auth != null;
    }

    // Deny everything else by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
